tbl_df() %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
filter(!is.na(IA))
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
tbl_df() %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
tbl_df() %>%
apply(2, function(x) gsub("^$|^ $", NA, x))
class(my_data)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
tbl_df() %>%
filter(!is.na(IA))
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
tbl_df()
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame()
aggr(my_data)
class(my_data)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA))
aggr(my_data)
class(my_data)
head(my_data)
unique(my_data$`Station Area`)
unique(my_data$Station Area)
unique(my_data[, "Station Area"]
unique(my_data[, "Station Area"])
length(unique(my_data[, "Station Area"]))
nrow(unique(my_data[, "Station Area"]))
str(my_data)
?format
foo <- my_data$TOC
foo <- head(my_data$TOC)
head(foo)
as.Date(foo)
?as.Date
foo <- as.string(head(my_data$TOC))
foo <- as.char(head(my_data$TOC))
foo <- as.character(head(my_data$TOC))
head(foo)
difftime(foo[2], foo[1])
as.difftime(c("0:3:20", "11:23:15"))
3.33 * 60
as.difftime(c("0:3:20", "0:5:20"))
gah <- as.POSIXct("0:3:20", format = "%H:%M:%S")
gah
foo <- head(my_data)
str(foo)
foo
foo$Date[1]
as.character(foo$Date[1])
as.character(foo$TOC)
as.character(foo$TOC[1])
gsub("/", "-", as.character(foo$Date[1]))
paste(gsub("/", "-", as.character(foo$Date[1])), as.character(foo$TOC[1]))
bar_time <- paste(gsub("/", "-", as.character(foo$Date[1])), as.character(foo$TOC[1]))
as.POSIXlt(bar_time)
?as.POSIXct
gah <- foo$TOC
gah
as.POSIXct(gah, format = "%H:%M:%S")
as.POSIXct(gah, format = "%H:%M:%S") %>%
gsub("[0-9]+-[0-9]+-[0-9]+ ", "")
as.POSIXct(gah, format = "%H:%M:%S") %>%
gsub("[0-9]+-[0-9]+-[0-9]+ ", "", .)
as.POSIXct(gah, format = "%H:%M:%S")
bar <- as.POSIXct(gah, format = "%H:%M:%S")
bar[2] - bar[1]
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(TOC, format = "%H:%M:%S"))
head(my_data)
str(my_data)
foo <- head(my_data)
foo$IA - foo$TOC
foo
foo[, c("TOC", "IA")]
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"))
foo <- head(my_data)
foo$IA - foo$TOC
my_data$response_mins <- my_data$TOC - my_data$IA
head(my_data)
head(my_data[, c("TOC", "IA")])
head(my_data[, c("TOC", "IA", "response_mins")])
my_data$response_mins <- my_data$IA - my_data$TOC
head(my_data[, c("TOC", "IA", "response_mins")])
my_data$response_mins <- (my_data$IA - my_data$TOC)/60
head(my_data[, c("TOC", "IA", "response_mins")])
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S")) %>%
mutate(response_mins = IA - TOC)
head(my_data)
str(my_data)
mean(my_data$response_mins)
summary(my_data$response_mins)
head(my_data$response_mins)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S")) %>%
mutate(response_time = IA - TOC)
head(my_data$response_time)
head(my_data$response_time)/60
mean(head(my_data$response_time)/60)
plot(density(head(my_data$response_time)))
as.numeric(my_data$response_time)
mean(head(my_data$response_time)/60)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S")) %>%
mutate(response_time = as.numeric(IA - TOC))
head(my_data)
head(my_data[, c("TOC", "IA", "response_time")])
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S")) %>%
mutate(response_time = as.numeric(IA - TOC)/60)
head(my_data[, c("TOC", "IA", "response_time")])
mean(my_data$response_time)
plot(density(my_data$response_time))
filter(my_data, response_time < 0)
filter(my_data, response_time < 0.5)
filter(my_data, response_time < 1)
filter(my_data, response_time > 0)
length(unique(my_data$DISTRICT_ID))
filter(my_data, response_time > 0) %>%
mean(response_time)
mean(my_data[my_data$response_time > 0, "response_time"])
my_data[my_data$response_time > 0, "response_time"]
mean(as.vector(my_data[my_data$response_time > 0, "response_time"]))
as.vector(my_data[my_data$response_time > 0, "response_time"])
head(my_data[, c("TOC", "IA", "response_time")])
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"))
install.packages("lubridate")
library(lubridate)
foo <- my_data[1, "TOC"]
foo
hms(foo)
gah <- hms(foo)
hours(gah)
minutes(gah)
seconds(gah)
foo <- head(my_data)
t.lub <- ymd_hms(foo$TOC)
t.lub
h.lub <- hour(t.lub) + minute(t.lub)/60
h.lub
t.lub
hour(t.lub)
minute(t.lub)/60
toc_lub <- ymd_hms(foo$TOC)
toc_hours <- hour(toc.lub) + minute(toc.lub)/60
toc_lub <- ymd_hms(foo$TOC)
toc_hours <- hour(toc_lub) + minute(toc_lub)/60
toc_hours
ia_lub <- ymd_hms(foo$IA)
ia_hours <- hour(ia_lub) + minute(ia_lub)
ia_lub
ia_hours
hour(ia_lub)
toc_hours <- hour(toc_lub) + minute(toc_lub)/60
ia_hours <- hour(ia_lub) + minute(ia_lub)/60
ia_hours
toc_hours - ia_hours
minute(toc_lub)
seconds(toc_lub) * 60
hour(toc_lub)*60 + minute(toc_lub) + seconds(toc_lub)/60
minute(toc_lub)
seconds(toc_lub)/60
seconds(toc_lub)
minute(toc_lub)
seconds(toc_lub)
hour(toc_lub)
toc_lub <- ymd_hms(foo$TOC)
toc_lub
seconds(toc_lub)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"))
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"),
response_time = NA)
head(my_data)
head(my_data[, c("TOC", "IA", "response_time")])
my_data[1, "TOC"]
my_data[1, "TOC"] < my_data[1, "IA"]
foo <- head(my_data)
i <- 1
my_data[i, "TOC"] < my_data[i, "IA"]
my_data[i, "TOC"] > my_data[i, "IA"]
my_data[i, "TOC"]
my_data[i, "IA"]
difftime(my_data[i, "TOC"],
my_data[i, "IA"],
units = "mins")
my_data[i, "TOC"]
filter(my_data, TOC - IA > 0)
my_data$TOC - my_data$IA
my_data$IA - my_data$TOC
filter(my_data, IA - TOC > 0)
my_data[my_data$IA - my_data$TOC > 0, ]
my_data[my_data$IA - my_data$TOC > 0, "response_time"]
my_data[my_data$IA - my_data$TOC > 0, "response_time"] <- my_data$IA - my_data$TOC
my_data[my_data$IA - my_data$TOC > 0, "response_time"] <-
my_data[my_data$IA - my_data$TOC > 0, ]$IA - my_data[, my_data$IA - my_data$TOC > 0]$TOC
my_data[my_data$IA - my_data$TOC > 0, "response_time"]
my_data[my_data$IA - my_data$TOC > 0, ]$IA
my_data[, my_data$IA - my_data$TOC > 0]$TOC
my_data[my_data$IA - my_data$TOC > 0, "response_time"] <-
my_data[my_data$IA - my_data$TOC > 0, ]$IA - my_data[my_data$IA - my_data$TOC > 0, ]$TOC
my_data_clean <- my_data[!is.na(my_data$response_time), ]
head(my_data_clean)
summary(my_data_clean$response_time)
867/60
plot(density(my_data_clean$response_time))
my_data_clean$response_time <- my_data_clean$response_time/60
summary(my_data_clean$response_time)
plot(density(my_data_clean$response_time))
sum(my_data_clean$response_time < 10)/length(my_data_clean$response_time)
sum(my_data_clean$response_time >= 10)/length(my_data_clean$response_time)
sum(my_data_clean$response_time >= 20)/length(my_data_clean$response_time)
sum(my_data_clean$response_time >= 30)/length(my_data_clean$response_time)
sum(my_data_clean$response_time >= 20)/length(my_data_clean$response_time)
head(my_data_clean)
group_by(my_data_clean, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_sd = sd(response_time))
group_by(my_data_clean, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_count = n())
bar <- group_by(my_data_clean, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_count = n())
sum(bar$the_count < 50)
sum(bar$the_count > 50)
summary(bar$the_count)
sum(bar$the_count)
sum(bar$the_count > 10)
sum(bar$the_count > 20)
rm(list = ls())
setwd("~/Documents/Insight Health Data Science/Project/")
library(data.table)
library(VIM)
library(dplyr)
library(lubridate)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"),
response_time = NA)
foo <- head(my_data)
foo$IA
24 + foo$IA
24 * 60
1440 + foo$IA
3600 * 24
60*60*24 + foo$IA
foo$IA
60*60*24 + foo$IA
my_data[my_data$IA - my_data$TOC < 0, "response_time"] <-
60*60*24 + my_data[my_data$IA - my_data$TOC < 0, ]$IA - my_data[my_data$IA - my_data$TOC < 0, ]$TOC
my_data[my_data$IA - my_data$TOC < 0, "response_time"]
my_data[my_data$IA - my_data$TOC < 0, c("TOC", "IA", "response_time")]
my_data[my_data$IA - my_data$TOC > 0, "response_time"]
rm(list = ls())
setwd("~/Documents/Insight Health Data Science/Project/")
library(data.table)
library(VIM)
library(dplyr)
library(lubridate)
my_data <- fread("Data/DCC_FireBrigadeAmbulanceIncidents2011.csv") %>%
apply(2, function(x) gsub("^$|^ $", NA, x)) %>%
as.data.frame() %>%
tbl_df() %>%
filter(!is.na(IA)) %>%
mutate(TOC = as.POSIXct(TOC, format = "%H:%M:%S"),
IA = as.POSIXct(IA, format = "%H:%M:%S"),
response_time = NA)
# Need to add 24 hours in case the pickup was early in the morning after a call before midnight
my_data[my_data$IA - my_data$TOC > 0, "response_time"] <-
my_data[my_data$IA - my_data$TOC > 0, ]$IA - my_data[my_data$IA - my_data$TOC > 0, ]$TOC
my_data[my_data$IA - my_data$TOC < 0, "response_time"] <-
60*60*24 + my_data[my_data$IA - my_data$TOC < 0, ]$IA - my_data[my_data$IA - my_data$TOC < 0, ]$TOC
summary(my_data$response_time)
my_data[my_data$IA - my_data$TOC > 0, ]$IA - my_data[my_data$IA - my_data$TOC > 0, ]$TOC
60*60*24 + my_data[my_data$IA - my_data$TOC < 0, ]$IA - my_data[my_data$IA - my_data$TOC < 0, ]$TOC
difftime(my_data[my_data$IA - my_data$TOC > 0, ]$IA, my_data[my_data$IA - my_data$TOC > 0, ]$TOC)
difftime(my_data[my_data$IA - my_data$TOC > 0, ]$IA, my_data[my_data$IA - my_data$TOC > 0, ]$TOC)
?difftime
difftime(my_data[my_data$IA - my_data$TOC > 0, ]$IA,
my_data[my_data$IA - my_data$TOC > 0, ]$TOC,
units = "mins")
difftime(my_data[my_data$IA - my_data$TOC < 0, ]$IA,
my_data[my_data$IA - my_data$TOC < 0, ]$TOC,
units = "mins")
difftime(60*60*24 + my_data[my_data$IA - my_data$TOC < 0, ]$IA,
my_data[my_data$IA - my_data$TOC < 0, ]$TOC,
units = "mins")
my_data[my_data$IA - my_data$TOC > 0, "response_time"] <-
difftime(my_data[my_data$IA - my_data$TOC > 0, ]$IA,
my_data[my_data$IA - my_data$TOC > 0, ]$TOC,
units = "mins")
my_data[my_data$IA - my_data$TOC < 0, "response_time"] <-
difftime(60*60*24 + my_data[my_data$IA - my_data$TOC < 0, ]$IA,
my_data[my_data$IA - my_data$TOC < 0, ]$TOC,
units = "mins")
summary(my_data$response_time)
df = data.frame(date=c("2012-02-01", "2012-02-01", "2012-02-02"))
df
df$day <- weekdays(as.Date(df$date))
df$day
foo <- head(my_data)
foo
as.Date(foo$Date)
as.Date(foo$Date, format = "%m/%d/%Y")
weekdays(as.Date(foo$Date, format = "%m/%d/%Y"))
my_data$weekday <- weekdays(as.Date(my_data$Date, format = "%m/%d/%Y"))
head(my_data)
unique(my_data$weekday)
filter(my_data$Date, is.na)
filter(my_data, is.na(Date))
filter(my_data, is.na(weekday))
as.Date("13/01/2011", format = "%m/%d/%Y")
as.Date("13/01/2011", format = "%d/%m/%Y")
my_data$weekday <- weekdays(as.Date(my_data$Date, format = "%d/%m/%Y"))
unique(my_data$weekday)
my_data$weekday <- factor(weekdays(as.Date(my_data$Date, format = "%d/%m/%Y")),
levels = c("Monday", "Tuesday", "Wednesday",
"Thursday", "Friday", "Saturday", "Sunday"))
str(my_data)
library(ggplot2)
install.packages("ggplot2")
library(ggplot2)
summary(my_data$response_time)
plot(density(my_data$response_time))
sum(my_data_clean$response_time < 10)/length(my_data_clean$response_time)
sum(my_data$response_time < 10)/length(my_data$response_time)
sum(my_data$response_time >= 20)/length(my_data$response_time)
group_by(my_data, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_count = n())
group_by(my_data, weekday) %>%
summarise(the_mean = mean(response_time),
the_count = n())
head(my_data)
foo <- head(my_data)
install.packages("lme4")
install.packages("lme4")
library(lme4)
foo
null_mod <- glmer(response_time ~ 1 + (1 | DISTRICT_ID), family = "binomial")
null_mod <- glmer(response_time ~ 1 + (1 | DISTRICT_ID), family = "binomial", data= my_data)
null_mod <- lmer(response_time ~ 1 + (1 | DISTRICT_ID), family = "binomial", data= my_data)
null_mod <- lmer(response_time ~ 1 + (1 | DISTRICT_ID), data= my_data)
null_mod
summary(null_mod)
null_mod <- lmer(response_time ~ weekday + (1 | DISTRICT_ID), data = my_data)
summary(null_mod)
anova(null_mod)
null_mod <- lmer(response_time ~ 1 + (1 | DISTRICT_ID), data = my_data)
summary(null_mod)
null_mod <- lmer(response_time ~ 1 + (1 | DISTRICT_ID), data = my_data)
summary(null_mod)
ranef(null_mod)
plot(density(ranef(null_mod)))
plot(density(ranef(null_mod)[, 1]))
dim(ranef(null_mod))
as.vector(ranef(null_mod))
is.vector(ranef(null_mod))
class(ranef(null_mod))
as.vector(ranef(null_mod))
plot(as.vector(ranef(null_mod)))
plot(response_time)
plot(my_dataresponse_time)
plot(my_data$response_time)
plot(density(my_data$response_time))
plot(density(log(my_data$response_time)))
null_mod <- lmer(log(response_time) ~ 1 + (1 | DISTRICT_ID), data = my_data)
summary(null_mod)
.045/(.045 + .29859)
plot(as.vector(ranef(null_mod)))
null_mod <- lmer(response_time ~ 1 + (1 | DISTRICT_ID), data = my_data)
summary(null_mod)
# 9.147/(9.147 + 107.792)
9.147/(9.147 + 107.792)
head(my_data)
ggplot(aes(x = TOC, y = response_time), data = my_data) + geom_point()
library(ggplot2)
ggplot(aes(x = TOC, y = response_time), data = my_data) + geom_point()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point() +
facet_grid(. ~ weekday) +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point(alpha = 0.5) +
facet_grid(. ~ weekday) +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point(alpha = 0.2) +
facet_grid(. ~ weekday) +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point(alpha = 0.2) +
facet_grid(. ~ weekday) +
geom_smooth(method = "loess") +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point(alpha = 0.2) +
facet_grid(. ~ weekday) +
geom_smooth(method = "loess", color = "red") +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = my_data) +
geom_point(alpha = 0.2) +
facet_grid(. ~ weekday) +
geom_smooth(method = "loess", color = "red", size = 2) +
theme_bw()
foo <- group_by(my_data, weekday) %>%
summarise(the_mean = mean(response_time),
the_count = n())
library(dplyr)
foo <- group_by(my_data, weekday) %>%
summarise(the_mean = mean(response_time),
the_count = n())
arrange(foo, the_mean)
foo <- group_by(my_data, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_count = n())
arrange(foo, the_mean)
arrange(foo, the_count, the_mean)
arrange(foo, the_count, the_mean, desc = TRUE)
arrange(foo, the_count, the_mean, decr = TRUE)
arrange(foo, desc(the_count), desc(the_mean))
gah <- filter(my_data, DISTRICT_ID %in% c("CITY CENTRE", "TALLAGHT"))
gah
ggplot(aes(x = TOC, y = response_time), data = gah) +
geom_point(alpha = 0.2) +
facet_grid(. ~ weekday) +
geom_smooth(method = "loess", color = "red", size = 2) +
theme_bw()
geom_point(alpha = 0.5) +
ggplot(aes(x = TOC, y = response_time), data = gah) +
geom_point(alpha = 0.5) +
facet_grid(. ~ weekday) +
geom_smooth(method = "loess", color = "red", size = 2) +
theme_bw()
ggplot(aes(x = TOC, y = response_time), data = gah) +
geom_point(alpha = 0.5) +
facet_grid(DISTRICT_ID ~ weekday) +
geom_smooth(method = "loess", color = "red", size = 2) +
theme_bw()
by_county <- group_by(my_data, DISTRICT_ID) %>%
summarise(the_mean = mean(response_time),
the_count = n())
arrange(by_county, desc(the_count), desc(the_mean))
data_by_county <- filter(my_data, DISTRICT_ID %in% c("CITY CENTRE", "TALLAGHT"))
ggplot(aes(x = TOC, y = response_time), data = data_by_county) +
geom_point(alpha = 0.5) +
facet_grid(DISTRICT_ID ~ weekday) +
geom_smooth(method = "loess", color = "red", size = 2) +
theme_bw()
head(my_data)
